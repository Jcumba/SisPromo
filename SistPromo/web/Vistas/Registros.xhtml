<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>TODO supply a title</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </h:head>
    <h:body>
        <ui:composition template="../Template/Template.xhtml">
            <ui:define name="linkRegistro">
                <li class="active"><a style="cursor: pointer"><i class="zmdi zmdi-calendar"></i> Registros</a></li>
            </ui:define>
            <ui:define name="content">
        <h:form id="From">
            <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" 
                      resizable="false" showHeader="false">
                <div class="preloader pl-lg" style="vertical-align: middle">
                    <svg class="pl-circular" viewBox="25 25 50 50">
                        <circle class="plc-path" cx="50" cy="50" r="20"/>
                    </svg>
                </div>
                <h:outputText value=" Cargando..." style="white-space: nowrap;"/>  
            </p:dialog>
            <p:growl id="msj" autoUpdate="true" showDetail="true"/>
            <!-- Card Registrar Colegios -->
            <div class="row">
                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-body card-padding">
                            <div class="row">
                                <div class="col-sm-2">
                                    <div class="form-group fg-float">
                                        <div class="fg-line">
                                            <label for="cbCarrera">Carrera</label>
                                            <p:selectOneMenu styleClass="selectpicker" id="cbCarrera" value="#{userController.usuario.codCarReg}" rendered="#{userController.usuario.TIPO_USER == '2'}" style="width: 100%">
                                                <f:selectItems value="#{userController.lstCbCarrera}" var="car" itemValue="#{car.codCarReg}" itemLabel="#{car.nomCarReg}"/>
                                            </p:selectOneMenu>
                                            <p:selectOneMenu styleClass="selectpicker" id="cbCarreraAdm" value="#{userController.usuario.codCarReg}" 
                                                             rendered="#{userController.usuario.TIPO_USER == '1'}" style="width: 100%">
                                                <f:selectItem itemLabel="Seleccione" noSelectionOption="true" itemDisabled="true"/>
                                                <f:selectItems value="#{userController.lstCbCarrera}" var="car" itemValue="#{car.codCarReg}" itemLabel="#{car.nomCarReg}"/>
                                                <p:ajax event="change" listener="#{userController.listaCbCursosAdm()}" update="cbCurso cbSecc cbFechas" onstart="PF('statusDialog').show()" oncomplete="PF('statusDialog').hide()"/>
                                            </p:selectOneMenu>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-2">
                                    <div class="form-group fg-float">
                                        <div class="fg-line">
                                            <label for="cbCurso">Curso</label>
                                            <p:selectOneMenu styleClass="selectpicker" value="#{userController.usuario.codCurReg}" id="cbCurso" style="width: 100%">
                                                <f:selectItem itemLabel="Curso" noSelectionOption="true" itemDisabled="true"/>
                                                <f:selectItems value="#{userController.lstCbCursos}" var="cur" itemValue="#{cur.codCurReg}" itemLabel="#{cur.nomCurReg}"/>
                                                <p:ajax event="change" listener="#{userController.listarCbSeccion()}" update="cbSecc" onstart="PF('statusDialog').show()" oncomplete="PF('statusDialog').hide()"/>
                                            </p:selectOneMenu>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-2">
                                    <div class="form-group fg-float">
                                        <div class="fg-line">
                                            <label for="cbSecc">Sección</label>
                                            <p:selectOneMenu styleClass="selectpicker" value="#{userController.usuario.seccReg}" id="cbSecc" style="width: 100%">
                                                <f:selectItem itemLabel="Sección" noSelectionOption="true" itemDisabled="true"/>
                                                <f:selectItems value="#{userController.lstCbSeccion}" var="sec" itemValue="#{sec.seccReg}" itemLabel="#{sec.seccReg}"/>
                                                <p:ajax event="change" listener="#{userController.listarCbFechas()}" update="cbFechas" onstart="PF('statusDialog').show()" oncomplete="PF('statusDialog').hide()"/>
                                            </p:selectOneMenu>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <div class="fg-line">
                                            <label for="cbFechas">Fecha</label>
                                            <p:selectOneMenu styleClass="selectpicker" value="#{userController.usuario.cbfechaReg}" id="cbFechas" style="width: 100%">
                                                <f:selectItem itemLabel="Selecione fecha" noSelectionOption="true" itemDisabled="true"/>
                                                <f:selectItems value="#{userController.lstCbFechas}" var="cf" itemValue="#{cf.cbfechaReg}" itemLabel="#{cf.cbfechaReg}"/>
                                                <p:ajax event="change" listener="#{userController.listarRegistros()}" update="formDataTable" onstart="PF('statusDialog').show()" oncomplete="PF('statusDialog').hide()"/>
                                            </p:selectOneMenu>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <h:panelGroup rendered="#{userController.usuario.TIPO_USER == '2'}">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <p:commandButton value="Nueva clase" class="btn btn-primary btn-block mio pull-left"
                                                                 actionListener="#{userController.consultaRegistro()}" id="btnAsistencia"
                                                                 oncomplete="PF('statusDialog').hide();PF('addRegDialog').show()"
                                                                 update=":regForm regForm:tblReg"
                                                                 onstart="PF('statusDialog').show()"/>
                                            </div>
                                        </div>
                                    </h:panelGroup>
                                    <br/>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <p:commandButton value="Limpiar" actionListener="#{userController.limpiar()}"
                                                             class="btn btn-warning btn-block mio pull-left" update="formDataTable cbFechas"/>
                                            <br/>
                                        </div>
                                        <h:panelGroup rendered="#{userController.usuario.TIPO_USER == '2'}">
                                            <div class="col-sm-6">
                                                <p:commandButton value="Eliminar clase" class="btn btn-danger btn-block" style="text-shadow:none"
                                                                 actionListener="#{userController.deleteRegistros()}" update="formDataTable From:cbFechas">
                                                    <p:confirm header="Eliminar clase" message="¿Estás seguro de eliminar esta clase?" icon="ui-icon-alert" />
                                                </p:commandButton>
                                                <p:confirmDialog global="true" showEffect="slide" hideEffect="drop">
                                                    <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                                                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                                                </p:confirmDialog>
                                            </div>
                                        </h:panelGroup>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Card Registrar Colegios -->
        </h:form>

        <h:form id="formDataTable">
            <h:panelGroup id="pgDataTable" rendered="#{userController.verTabla}">
                <div class="card">
                    <div class="row">
                        <div class="col-md-12">
                            <p:dataTable value="#{userController.lstRegistros}" var="reg" scrollable="true" scrollHeight="500"
                                         id="tblRegistro" editable="true">
                                <p:ajax event="rowEdit" listener="#{userController.updateRegistros}" update="tblRegistro" />
                                <p:ajax event="rowEditCancel" listener="#{userController.cancelarUpdateReg}" update="tblRegistro"/>

                                <p:columnGroup type="header">
                                    <p:row>
                                        <p:column rowspan="4" headerText="N°" style="width: 3%"/>
                                        <p:column rowspan="4" headerText="Apellidos y nombres" style="width: 30%"/>
                                        <p:column colspan="#{userController.numRowCol}" headerText="#{userController.usuario.cbfechaReg}" style="width: 25%"/>
                                        <p:column rowspan="4" headerText="Editar" style="width: 20px" />
                                    </p:row>
                                    <p:row>
                                        <ui:repeat var="lf" value="#{userController.lstFechas}" >
                                            <p:column colspan="#{userController.numRowCol}" headerText="#{lf.nomcoPerView}" style="width: 20%"/>
                                        </ui:repeat>
                                    </p:row>
                                    <p:row>
                                        <p:column rowspan="#{userController.numRowCol}" headerText="Asistencia"/>
                                        <p:column rowspan="2" headerText="Nota" rendered="#{userController.colRow}"/>
                                    </p:row>
                                </p:columnGroup>    
                                <p:column  style="height: 5%;text-align: right">
                                    <h:outputText value="#{reg.ROWNUM}" />
                                </p:column>
                                <p:column groupRow="true" style="height: 5%">
                                    <h:outputText value="#{reg.nomPerView}" />
                                </p:column> 
                                <p:column>
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <center>
                                                <h:outputText value="#{reg.asisPerView}"/>
                                            </center>
                                        </f:facet>
                                        <f:facet name="input">
                                            <center>
                                                <p:selectOneMenu value="#{reg.asisPerView}" style="width: 100%">
                                                    <f:selectItem itemLabel="A" itemValue="A"/>
                                                    <f:selectItem itemLabel="F" itemValue="F"/>
                                                </p:selectOneMenu>  
                                            </center>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column rendered="#{userController.colRow}">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <center>
                                                <h:outputText value="#{reg.notaPerView}"/>
                                            </center>
                                        </f:facet>
                                        <f:facet name="input">
                                            <center>
                                                <p:inputNumber value="#{reg.notaPerView}" style="width: 100%"
                                                               minValue="0" maxValue="20" required="true" requiredMessage="Ingrese una nota."/>
                                            </center>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column>
                                    <p:rowEditor/>
                                </p:column>
                            </p:dataTable> 
                        </div>
                        <ui:remove>
                            <div class="col-md-1" >
                                <p:dataTable value="#{userController.lstPromedios}" var="prom" id="tblProm" scrollable="true" > 
                                    <p:columnGroup type="header" >
                                        <p:row>
                                            <p:column rowspan="4" headerText="Promedio" style="padding-top: 32px;width:20px;word-wrap: break-word;text-align:center;line-height:20px;font-size: 0.5em" />
                                        </p:row>
                                    </p:columnGroup>
                                    <p:column style="width: 100%">
                                        <h:outputText value="#{prom.PROMEDIO}" class="#{prom.PROMEDIO lt 13 ? 'notaMenor' : 'notaMayor'}"/>
                                    </p:column>
                                </p:dataTable> 
                            </div>
                        </ui:remove>
                    </div>
                </div>
            </h:panelGroup>
        </h:form>

        <!-- Dialog para registrar registros -->
        <p:dialog widgetVar="addRegDialog" id="addRegDlg" header="Agregar Registros"
                  appendTo="@(body)" responsive="true"
                  closeOnEscape="true" closable="true" 
                  maximizable="true" minimizable="true"
                  width="650">
            <h:form id="regForm">
                <div class="row">
                    <div class="col-md-2">
                        <div class="form-group ">
                            <div class="fg-line">
                                <label for="txtFnacEst">Fecha</label>
                                <p:inputMask id="txtFnacEst" class="form-control" required="true" requiredMessage="Ingrese la fecha"
                                             value="#{userController.usuario.fechReg}" mask="00/00/0000"/>
                            </div>
                        </div>
                    </div>
                    <h:panelGroup id="pgNomC">
                        <div class="col-md-4">
                            <div class="form-group">
                                <div class="fg-line">
                                    <label for="txtNonC">Nombre del criterio o clase</label>
                                    <p:inputText id="txtNonC" class="form-control fg-input" required="true" requiredMessage="Ingrese el nombre"
                                                 value="#{userController.usuario.nomCriterio}" maxlength="30"/>
                                </div>
                            </div>
                        </div>
                    </h:panelGroup>
                    <div class="col-md-3">
                        <p:commandButton value="AGREGAR CRITERIO" class="mio pull-right btn-block"
                                         id="btnAddCr" update="tblReg regForm pgNomC"
                                         rendered="#{userController.buttonCriterio}"
                                         actionListener="#{userController.agregarCriterio()}"/>
                        <p:commandButton value="ELIMINAR CRITERIO" class="mio pull-right btn-block" 
                                         id="btnDelCr" update="tblReg regForm pgNomC"
                                         actionListener="#{userController.borrarCriterio()}"
                                         rendered="#{!userController.buttonCriterio}"/>
                    </div>
                    <div class="col-md-3">
                        <p:commandButton value="REGISTRAR CLASE" class="mio pull-right btn-block" update="tblReg regForm pgNomC From:cbFechas"
                                         actionListener="#{userController.validarRegistros()}"/>
                    </div>
                </div>
                <p:dataTable value="#{userController.lstRegistrosReg}"
                             var="reg" id="tblReg" editable="true"
                             editMode="cell" emptyMessage="No se encontro ningún registro"
                             scrollable="true" scrollHeight="500">
                    <p:column headerText="N°" style="width: 5%">
                        <p:outputLabel value="#{reg.numOrdenReg}" style="color: #000"/>
                    </p:column>
                    <p:column headerText="Apellidos y nombres" style="width: 45%">
                        <p:outputLabel value="#{reg.nomPerReg}" style="color: #000"/>
                    </p:column>
                    <p:column headerText="Asistencia" style="width: 10%" id="colAs">
                        <center><p:selectBooleanCheckbox value="#{reg.asisReg}"/></center>
                    </p:column>
                    <p:column rendered="#{!userController.buttonCriterio}" headerText="Criterio" style="width: 10%">
                        <p:cellEditor>
                            <f:facet name="output"><center><p:outputLabel value="#{reg.notasRegPintado}" style="color: #000"/></center></f:facet>
                            <f:facet name="input">
                                <center>
                                    <p:inputNumber value="#{reg.notasReg}" style="width: 100%; height: 50%; color: #ffffff"
                                                   minValue="0" maxValue="20"/>
                                </center>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:dialog>
        </ui:define>    
        </ui:composition>
    </h:body>
</html>
